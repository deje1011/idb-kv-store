(function(e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e()}else if(typeof define==="function"&&define.amd){define([],e)}else{var t;if(typeof window!=="undefined"){t=window}else if(typeof global!=="undefined"){t=global}else if(typeof self!=="undefined"){t=self}else{t=this}t.IdbKvStore=e()}})(function(){var e,t,r;return function(){function e(t,r,n){function i(s,u){if(!r[s]){if(!t[s]){var l=typeof require=="function"&&require;if(!u&&l)return l(s,!0);if(o)return o(s,!0);var a=new Error("Cannot find module '"+s+"'");throw a.code="MODULE_NOT_FOUND",a}var f=r[s]={exports:{}};t[s][0].call(f.exports,function(e){var r=t[s][1][e];return i(r?r:e)},f,f.exports,e,t,r,n)}return r[s].exports}var o=typeof require=="function"&&require;for(var s=0;s<n.length;s++)i(n[s]);return i}return e}()({1:[function(e,t,r){function n(){this._events=this._events||{};this._maxListeners=this._maxListeners||undefined}t.exports=n;n.EventEmitter=n;n.prototype._events=undefined;n.prototype._maxListeners=undefined;n.defaultMaxListeners=10;n.prototype.setMaxListeners=function(e){if(!o(e)||e<0||isNaN(e))throw TypeError("n must be a positive number");this._maxListeners=e;return this};n.prototype.emit=function(e){var t,r,n,o,l,a;if(!this._events)this._events={};if(e==="error"){if(!this._events.error||s(this._events.error)&&!this._events.error.length){t=arguments[1];if(t instanceof Error){throw t}else{var f=new Error('Uncaught, unspecified "error" event. ('+t+")");f.context=t;throw f}}}r=this._events[e];if(u(r))return false;if(i(r)){switch(arguments.length){case 1:r.call(this);break;case 2:r.call(this,arguments[1]);break;case 3:r.call(this,arguments[1],arguments[2]);break;default:o=Array.prototype.slice.call(arguments,1);r.apply(this,o)}}else if(s(r)){o=Array.prototype.slice.call(arguments,1);a=r.slice();n=a.length;for(l=0;l<n;l++)a[l].apply(this,o)}return true};n.prototype.addListener=function(e,t){var r;if(!i(t))throw TypeError("listener must be a function");if(!this._events)this._events={};if(this._events.newListener)this.emit("newListener",e,i(t.listener)?t.listener:t);if(!this._events[e])this._events[e]=t;else if(s(this._events[e]))this._events[e].push(t);else this._events[e]=[this._events[e],t];if(s(this._events[e])&&!this._events[e].warned){if(!u(this._maxListeners)){r=this._maxListeners}else{r=n.defaultMaxListeners}if(r&&r>0&&this._events[e].length>r){this._events[e].warned=true;console.error("(node) warning: possible EventEmitter memory "+"leak detected. %d listeners added. "+"Use emitter.setMaxListeners() to increase limit.",this._events[e].length);if(typeof console.trace==="function"){console.trace()}}}return this};n.prototype.on=n.prototype.addListener;n.prototype.once=function(e,t){if(!i(t))throw TypeError("listener must be a function");var r=false;function n(){this.removeListener(e,n);if(!r){r=true;t.apply(this,arguments)}}n.listener=t;this.on(e,n);return this};n.prototype.removeListener=function(e,t){var r,n,o,u;if(!i(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;r=this._events[e];o=r.length;n=-1;if(r===t||i(r.listener)&&r.listener===t){delete this._events[e];if(this._events.removeListener)this.emit("removeListener",e,t)}else if(s(r)){for(u=o;u-- >0;){if(r[u]===t||r[u].listener&&r[u].listener===t){n=u;break}}if(n<0)return this;if(r.length===1){r.length=0;delete this._events[e]}else{r.splice(n,1)}if(this._events.removeListener)this.emit("removeListener",e,t)}return this};n.prototype.removeAllListeners=function(e){var t,r;if(!this._events)return this;if(!this._events.removeListener){if(arguments.length===0)this._events={};else if(this._events[e])delete this._events[e];return this}if(arguments.length===0){for(t in this._events){if(t==="removeListener")continue;this.removeAllListeners(t)}this.removeAllListeners("removeListener");this._events={};return this}r=this._events[e];if(i(r)){this.removeListener(e,r)}else if(r){while(r.length)this.removeListener(e,r[r.length-1])}delete this._events[e];return this};n.prototype.listeners=function(e){var t;if(!this._events||!this._events[e])t=[];else if(i(this._events[e]))t=[this._events[e]];else t=this._events[e].slice();return t};n.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(i(t))return 1;else if(t)return t.length}return 0};n.listenerCount=function(e,t){return e.listenerCount(t)};function i(e){return typeof e==="function"}function o(e){return typeof e==="number"}function s(e){return typeof e==="object"&&e!==null}function u(e){return e===void 0}},{}],2:[function(e,t,r){if(typeof Object.create==="function"){t.exports=function e(t,r){t.super_=r;t.prototype=Object.create(r.prototype,{constructor:{value:t,enumerable:false,writable:true,configurable:true}})}}else{t.exports=function e(t,r){t.super_=r;var n=function(){};n.prototype=r.prototype;t.prototype=new n;t.prototype.constructor=t}}},{}],3:[function(e,t,r){t.exports=n;function n(e){var t;var r;var n;if(e!=null&&typeof e!=="function")throw new Error("cb must be a function");if(e==null&&typeof Promise!=="undefined"){t=new Promise(function(e,t){r=e;n=t})}function i(i,o){if(t){if(i)n(i);else r(o)}else{if(e)e(i,o);else if(i)throw i}}i.promise=t;return i}},{}],"/":[function(e,t,r){t.exports=l;var n=e("events").EventEmitter;var i=e("inherits");var o=e("promisize");var s=typeof window==="undefined"?self:window;var u=s.indexedDB||s.mozIndexedDB||s.webkitIndexedDB||s.msIndexedDB;l.INDEXEDDB_SUPPORT=u!=null;l.BROADCAST_SUPPORT=s.BroadcastChannel!=null;i(l,n);function l(e,t,r){var i=this;if(typeof e!=="string")throw new Error("A name must be supplied of type string");if(!u)throw new Error("IndexedDB not supported");if(typeof t==="function")return new l(e,null,t);if(!(i instanceof l))return new l(e,t,r);if(!t)t={};n.call(i);i._db=null;i._closed=false;i._channel=null;i._waiters=[];var o=t.channel||s.BroadcastChannel;if(o){i._channel=new o(e);i._channel.onmessage=y}var a=u.open(e);a.onerror=c;a.onsuccess=p;a.onupgradeneeded=v;i.on("newListener",_);function c(e){f(e);i._close(e.target.error);if(r)r(e.target.error)}function h(e){f(e);i._close(e.target.error)}function p(e){if(i._closed){e.target.result.close()}else{i._db=e.target.result;i._db.onclose=d;i._db.onerror=h;for(var t in i._waiters)i._waiters[t]._init(null);i._waiters=null;if(r)r(null);i.emit("open")}}function v(e){var t=e.target.result;t.createObjectStore("kv",{autoIncrement:true})}function d(){i._close()}function _(e){if(e!=="add"&&e!=="set"&&e!=="remove")return;if(!i._channel)return i.emit("error",new Error("No BroadcastChannel support"))}function y(e){if(e.data.method==="add")i.emit("add",e.data);else if(e.data.method==="set")i.emit("set",e.data);else if(e.data.method==="remove")i.emit("remove",e.data)}}l.prototype.get=function(e,t){return this.transaction("readonly").get(e,t)};l.prototype.getMultiple=function(e,t){return this.transaction("readonly").getMultiple(e,t)};l.prototype.set=function(e,t,r){return this.transaction("readwrite").set(e,t,r)};l.prototype.json=function(e,t){return this.transaction("readonly").json(e,t)};l.prototype.keys=function(e,t){return this.transaction("readonly").keys(e,t)};l.prototype.values=function(e,t){return this.transaction("readonly").values(e,t)};l.prototype.remove=function(e,t){return this.transaction("readwrite").remove(e,t)};l.prototype.clear=function(e){return this.transaction("readwrite").clear(e)};l.prototype.count=function(e,t){return this.transaction("readonly").count(e,t)};l.prototype.add=function(e,t,r){return this.transaction("readwrite").add(e,t,r)};l.prototype.iterator=function(e,t){return this.transaction("readonly").iterator(e,t)};l.prototype.transaction=function(e){if(this._closed)throw new Error("Database is closed");var t=new a(this,e);if(this._db)t._init(null);else this._waiters.push(t);return t};l.prototype.close=function(){this._close()};l.prototype._close=function(e){if(this._closed)return;this._closed=true;if(this._db)this._db.close();if(this._channel)this._channel.close();this._db=null;this._channel=null;if(e)this.emit("error",e);this.emit("close");for(var t in this._waiters)this._waiters[t]._init(e||new Error("Database is closed"));this._waiters=null;this.removeAllListeners()};function a(e,t){this._kvStore=e;this._mode=t||"readwrite";this._objectStore=null;this._waiters=null;this.finished=false;this.onfinish=null;if(this._mode!=="readonly"&&this._mode!=="readwrite"){throw new Error('mode must be either "readonly" or "readwrite"')}}a.prototype._init=function(e){var t=this;if(t.finished)return;if(e)return t._close(e);var r=t._kvStore._db.transaction("kv",t._mode);r.oncomplete=i;r.onerror=o;t._objectStore=r.objectStore("kv");for(var n in t._waiters)t._waiters[n](null,t._objectStore);t._waiters=null;function i(){t._close(null)}function o(e){f(e);t._close(e.target.error)}};a.prototype._getObjectStore=function(e){if(this.finished)throw new Error("Transaction is finished");if(this._objectStore)return e(null,this._objectStore);this._waiters=this._waiters||[];this._waiters.push(e)};a.prototype.set=function(e,t,r){var n=this;if(e==null||t==null)throw new Error("A key and value must be given");r=o(r);n._getObjectStore(function(i,o){if(i)return r(i);try{var s=o.put(t,e)}catch(e){return r(e)}s.onerror=f.bind(this,r);s.onsuccess=function(){if(n._kvStore._channel){n._kvStore._channel.postMessage({method:"set",key:e,value:t})}r(null)}});return r.promise};a.prototype.add=function(e,t,r){var n=this;if(t==null&&e!=null)return n.add(undefined,e,r);if(typeof t==="function"||t==null&&r==null)return n.add(undefined,e,t);if(t==null)throw new Error("A value must be provided as an argument");r=o(r);n._getObjectStore(function(i,o){if(i)return r(i);try{var s=e==null?o.add(t):o.add(t,e)}catch(e){return r(e)}s.onerror=f.bind(this,r);s.onsuccess=function(){if(n._kvStore._channel){n._kvStore._channel.postMessage({method:"add",key:e,value:t})}r(null)}});return r.promise};a.prototype.get=function(e,t){var r=this;if(e==null)throw new Error("A key must be given as an argument");t=o(t);r._getObjectStore(function(r,n){if(r)return t(r);try{var i=n.get(e)}catch(e){return t(e)}i.onerror=f.bind(this,t);i.onsuccess=function(e){t(null,e.target.result)}});return t.promise};a.prototype.getMultiple=function(e,t){var r=this;if(e==null)throw new Error("An array of keys must be given as an argument");t=o(t);if(e.length===0){t(null,[]);return t.promise}r._getObjectStore(function(r,n){if(r)return t(r);var i=e.slice().sort();var o=0;var s=[];var u=n.openCursor();u.onerror=f.bind(this,t);u.onsuccess=function(r){var n=r.target.result;if(!n){t(null,s);return}var u=n.key;while(u>i[o]){++o;if(o===i.length){t(null,s);return}}if(u===i[o]){s[e.indexOf(u)]=n.value;n.continue()}else{n.continue(i[o])}}});return t.promise};a.prototype.json=function(e,t){var r=this;if(typeof e==="function")return r.json(null,e);t=o(t);var n={};r.iterator(e,function(e,r){if(e)return t(e);if(r){n[r.key]=r.value;r.continue()}else{t(null,n)}});return t.promise};a.prototype.keys=function(e,t){var r=this;if(typeof e==="function")return r.keys(null,e);t=o(t);var n=[];r.iterator(e,function(e,r){if(e)return t(e);if(r){n.push(r.key);r.continue()}else{t(null,n)}});return t.promise};a.prototype.values=function(e,t){var r=this;if(typeof e==="function")return r.values(null,e);t=o(t);var n=[];r.iterator(e,function(e,r){if(e)return t(e);if(r){n.push(r.value);r.continue()}else{t(null,n)}});return t.promise};a.prototype.remove=function(e,t){var r=this;if(e==null)throw new Error("A key must be given as an argument");t=o(t);r._getObjectStore(function(n,i){if(n)return t(n);try{var o=i.delete(e)}catch(e){return t(e)}o.onerror=f.bind(this,t);o.onsuccess=function(){if(r._kvStore._channel){r._kvStore._channel.postMessage({method:"remove",key:e})}t(null)}});return t.promise};a.prototype.clear=function(e){var t=this;e=o(e);t._getObjectStore(function(t,r){if(t)return e(t);try{var n=r.clear()}catch(t){return e(t)}n.onerror=f.bind(this,e);n.onsuccess=function(){e(null)}});return e.promise};a.prototype.count=function(e,t){var r=this;if(typeof e==="function")return r.count(null,e);t=o(t);r._getObjectStore(function(r,n){if(r)return t(r);try{var i=e==null?n.count():n.count(e)}catch(e){return t(e)}i.onerror=f.bind(this,t);i.onsuccess=function(e){t(null,e.target.result)}});return t.promise};a.prototype.iterator=function(e,t){var r=this;if(typeof e==="function")return r.iterator(null,e);if(typeof t!=="function")throw new Error("A function must be given");r._getObjectStore(function(r,n){if(r)return t(r);try{var i=e==null?n.openCursor():n.openCursor(e)}catch(e){return t(e)}i.onerror=f.bind(this,t);i.onsuccess=function(e){var r=e.target.result;t(null,r)}})};a.prototype.abort=function(){if(this.finished)throw new Error("Transaction is finished");if(this._objectStore)this._objectStore.transaction.abort();this._close(new Error("Transaction aborted"))};a.prototype._close=function(e){if(this.finished)return;this.finished=true;this._kvStore=null;this._objectStore=null;for(var t in this._waiters)this._waiters[t](e||new Error("Transaction is finished"));if(this.onfinish)this.onfinish(e);this.onfinish=null;this._waiters=null};function f(e,t){if(t==null)return f(null,e);t.preventDefault();t.stopPropagation();if(e)e(t.target.error)}},{events:1,inherits:2,promisize:3}]},{},[])("/")});
